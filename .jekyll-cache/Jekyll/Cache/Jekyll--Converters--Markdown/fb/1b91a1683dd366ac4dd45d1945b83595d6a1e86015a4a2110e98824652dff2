I"Ã2<h2 id="javaè¿‡æ»¤å™¨">JAVAè¿‡æ»¤å™¨</h2>

<h3 id="è¿‡æ»¤å™¨åº”ç”¨åœºæ™¯">è¿‡æ»¤å™¨åº”ç”¨åœºæ™¯</h3>

<p>Webèµ„æºæƒé™è®¿é—®æ§åˆ¶</p>

<p>è¯·æ±‚å­—ç¬¦é›†ç¼–ç å¤„ç†</p>

<p>å†…å®¹æ•æ„Ÿå­—ç¬¦è¯æ±‡è¿‡æ»¤</p>

<p>å“åº”ä¿¡æ¯å‹ç¼©</p>

<h3 id="è¿‡æ»¤å™¨å·¥ä½œæµç¨‹">è¿‡æ»¤å™¨å·¥ä½œæµç¨‹</h3>

<p><img src="/img/in-post/1603857853322.png" /></p>

<h3 id="è¿‡æ»¤å™¨çš„ç”Ÿå‘½å‘¨æœŸ">è¿‡æ»¤å™¨çš„ç”Ÿå‘½å‘¨æœŸ</h3>

<p>webåº”ç”¨ç¨‹åº<strong>å¯åŠ¨</strong>æ—¶ï¼ŒwebæœåŠ¡å™¨<strong>åˆ›å»º</strong>filterçš„å®ä¾‹å¯¹è±¡ï¼Œä»¥åŠå¯¹è±¡çš„<strong>åˆå§‹åŒ–</strong>ã€‚</p>

<p>å½“è¯·æ±‚è®¿é—®ä¸è¿‡æ»¤å™¨<strong>å…³è”</strong>çš„Webèµ„æºæ—¶ï¼Œè¿‡æ»¤å™¨<strong>æ‹¦æˆªè¯·æ±‚</strong>ï¼Œ<strong>å®ŒæˆæŒ‡å®šåŠŸèƒ½</strong></p>

<p>Filterå¯¹è±¡åˆ›å»ºåä¼š<strong>é©»ç•™åœ¨å†…å­˜</strong>ï¼Œåœ¨webåº”ç”¨ç§»é™¤æˆ–æœåŠ¡å™¨<strong>åœæ­¢</strong>æ—¶æ‰<strong>é”€æ¯</strong></p>

<p>è¿‡æ»¤å™¨çš„åˆ›å»ºå’Œé”€æ¯ç”±<strong>webæœåŠ¡å™¨è´Ÿè´£</strong></p>

<h3 id="è¿‡æ»¤å™¨çš„å®ç°æ­¥éª¤">è¿‡æ»¤å™¨çš„å®ç°æ­¥éª¤</h3>

<p>1ã€ç¼–å†™javaç±»å®ç°Filteræ¥å£ï¼Œå¹¶å®ç°å…¶doFilteræ–¹æ³•</p>

<p>2ã€åœ¨web.xmlæ–‡ä»¶ä¸­å¯¹filterç±»è¿›è¡Œæ³¨å†Œï¼Œå¹¶è®¾ç½®æ‰€æ‹¦æˆªçš„èµ„æº</p>

<h4 id="è¿‡æ»¤å™¨é“¾">è¿‡æ»¤å™¨é“¾</h4>

<p>åœ¨ä¸€ä¸ªwebåº”ç”¨ä¸­ï¼Œå¤šä¸ªè¿‡æ»¤å™¨ç»„åˆèµ·æ¥ç§°ä¸ºä¸€ä¸ªè¿‡æ»¤å™¨é“¾</p>

<p>è¿‡æ»¤å™¨çš„è°ƒç”¨é¡ºåºå–å†³äºè¿‡æ»¤å™¨åœ¨web.xmlæ–‡ä»¶ä¸­çš„æ³¨å†Œé¡ºåº</p>

<h3 id="ä¸¾ä¸ªæ —å­">ä¸¾ä¸ªæ —å­</h3>

<p><strong>ä¾‹</strong></p>

<p>javaé¡µé¢:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">test</span> <span class="kd">implements</span> <span class="nc">Filter</span><span class="o">{</span>

	<span class="cm">/**
	 * é”€æ¯æ–¹æ³•ï¼Œåšæ¸…ç†æ“ä½œ
	 */</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ‹¦æˆªå™¨é”€æ¯"</span><span class="o">);</span>
		
	<span class="o">}</span>

	<span class="cm">/**
	 *  ä¸»è¦æ–¹æ³•ï¼Œå®Œæˆè¿‡æ»¤å™¨åŠŸèƒ½
	 *  FilterChain è¿‡æ»¤å™¨é“¾å¯¹è±¡
	 */</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">requert</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ‹¦æˆªå¤„ç†"</span><span class="o">);</span>
		<span class="c1">//æ–¹æ³•å†…è·å–åˆå§‹åŒ–èš•é£Ÿ</span>
		<span class="nc">String</span> <span class="n">systemName</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">"systemName"</span><span class="o">);</span> 
		<span class="c1">//æ‹¦æˆªå®Œæˆåé€šçŸ¥WEBæœåŠ¡å™¨å·²å®Œæˆï¼Œè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œæˆ–æ‰§è¡Œè¿‡æ»¤å™¨é“¾çš„ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨è‹¥æ²¡æœ‰åˆ™æ‰§è¡Œè¯·æ±‚ï¼Œå¯¹è¯·æ±‚èµ„æºè¿›è¡Œå¤„ç†</span>
		<span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">requert</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="cm">/**
	 * åˆå§‹åŒ–æ–¹æ³•
	 */</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ‹¦æˆªå™¨åˆå§‹åŒ–"</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">;</span><span class="c1">//è·å–åˆå§‹åŒ–å‚æ•°</span>
	<span class="o">}</span>
	
	<span class="kd">private</span> <span class="nc">FilterConfig</span> <span class="n">config</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div></div>

<p>web.xmlé¡µé¢</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>characterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span><span class="c">&lt;!-- åç§° --&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>test<span class="nt">&lt;/filter-class&gt;</span><span class="c">&lt;!-- æ‰€åœ¨ç±» --&gt;</span>

		<span class="nt">&lt;init-param&gt;</span><span class="c">&lt;!-- åˆå§‹åŒ–å‚æ•° --&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>systemName<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>key<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>


	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>characterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span><span class="c">&lt;!-- æ˜ å°„çš„è¿‡æ»¤å™¨ --&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span><span class="c">&lt;!-- å¯¹æ‰€æœ‰çš„è¯·æ±‚éƒ½åšæ‹¦æˆªå¤„ç† --&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
</code></pre></div></div>

<p>ä¾‹2ï¼šè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharacterEncodingFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">FilterConfig</span> <span class="n">config</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>

		<span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">"charset"</span><span class="o">));</span><span class="c1">// æ ¹æ®è¿‡æ»¤å™¨é…ç½®å­—ç¬¦é›†ï¼Œè®¾ç½®è¯·æ±‚å­—ç¬¦é›†ç¼–ç </span>

		<span class="c1">// System.out.println("characterEncodingFilter è¯·æ±‚é¢„å¤„ç†");//æµ‹è¯•è¿‡æ»¤å™¨ï¼ˆé“¾ï¼‰å·¥ä½œæµç¨‹ä½¿ç”¨</span>
		<span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
		<span class="c1">// System.out.println("characterEncodingFilter å“åº”åå¤„ç†");//æµ‹è¯•è¿‡æ»¤å™¨ï¼ˆé“¾ï¼‰å·¥ä½œæµç¨‹ä½¿ç”¨</span>

	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">;</span>

	<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>xml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- å­—ç¬¦é›†ç¼–ç è¿‡æ»¤å™¨é…ç½® --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>characterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span><span class="c">&lt;!-- åç§° --&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span><span class="c">&lt;!-- æ‰€åœ¨ç±» --&gt;</span>

		<span class="nt">&lt;init-param&gt;</span><span class="c">&lt;!-- åˆå§‹åŒ–å‚æ•° --&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>charset<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>


	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>characterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span><span class="c">&lt;!-- æ˜ å°„çš„è¿‡æ»¤å™¨ --&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span><span class="c">&lt;!-- å¯¹æ‰€æœ‰çš„è¯·æ±‚éƒ½åšæ‹¦æˆªå¤„ç† --&gt;</span>

	<span class="nt">&lt;/filter-mapping&gt;</span>
</code></pre></div></div>

<p>ä¾‹3 ç™»å½•å®‰å…¨æ§åˆ¶è¿‡æ»¤å™¨</p>

<p>java:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class SessionFilter implements Filter {

	@Override
	public void destroy() {

	}

	@Override
	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
			throws IOException, ServletException {

		HttpServletRequest hrequest = (HttpServletRequest) request;// æ¶‰åŠåˆ°HTTPè¯·æ±‚å¤„ç†ï¼Œè½¬å‹å¤„ç†
		HttpServletResponse hresponse = (HttpServletResponse) response;// æ¶‰åŠåˆ°HTTPè¯·æ±‚å¤„ç†ï¼Œè½¬å‹å¤„ç†

		String loginUser = (String) hrequest.getSession().getAttribute("loginUser");// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å®Œæˆäº†ç™»å½•æ“ä½œï¼Œsessionä¸­æ˜¯å¦å­˜å‚¨ç”¨æˆ·å

		if (loginUser == null) {
			hresponse.sendRedirect(hrequest.getContextPath() + "/index.jsp?flag=1");// æœªç™»å½•ï¼Œç³»ç»Ÿå¼ºåˆ¶é‡å®šå‘è‡³ç™»å½•é¡µé¢
			return;
		} else {
			chain.doFilter(hrequest, hresponse);
			return;
		}

	}

	@Override
	public void init(FilterConfig config) throws ServletException {

	}

}
</code></pre></div></div>

<p>xml:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- ç”¨æˆ·ç™»å½•å®‰å…¨æ§åˆ¶è¿‡æ»¤å™¨é…ç½® --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>sessionFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>filter.SessionFilter<span class="nt">&lt;/filter-class&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>

	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>sessionFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/message.jsp<span class="nt">&lt;/url-pattern&gt;</span><span class="c">&lt;!-- å¯¹è®¿é—®è¯¥é¡µé¢çš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤ --&gt;</span>
        <span class="nt">&lt;dispatcher&gt;</span>REQUEST<span class="nt">&lt;/dispatcher&gt;</span>
         <span class="nt">&lt;dispatcher&gt;</span>ERROR<span class="nt">&lt;/dispatcher&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
</code></pre></div></div>

<h3 id="è¿‡æ»¤å™¨é…ç½®">è¿‡æ»¤å™¨é…ç½®</h3>

<p>filter-mappingå­å…ƒç´ dispatcher</p>

<p>REQUESTâ€“ç›´æ¥è®¿é—®é¡µé¢ï¼ˆé»˜è®¤ï¼‰</p>

<p>INCLUDEâ€“é€šè¿‡includeè®¿é—®å¦å¤–çš„é¡µé¢</p>

<p>FORWARDâ€“é€šè¿‡forwardè®¿é—®</p>

<p>ERRORâ€“å¼‚å¸¸å¤„ç†æœºåˆ¶è°ƒç”¨æ—¶</p>
:ET